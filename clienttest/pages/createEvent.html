<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Event - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-md">
    <h2 class="text-2xl font-bold mb-6 text-center">Create event</h2>
    <form id="createEventForm" class="space-y-6">
      <div>
        <label for="title" class="block text-sm font-medium text-gray-700 mb-1">Event name</label>
        <input type="text" id="title" placeholder="Event name" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" required>
      </div>
      <div>
        <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
        <textarea id="description" placeholder="Description" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" rows="3"></textarea>
      </div>
      <div>
        <label for="location" class="block text-sm font-medium text-gray-700 mb-1">Location</label>
        <input type="text" id="location" placeholder="Location" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="minAttendees" class="block text-sm font-medium text-gray-700 mb-1">Min attendees</label>
          <input type="number" id="minAttendees" placeholder="Min attendees" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label for="maxAttendees" class="block text-sm font-medium text-gray-700 mb-1">Max attendees</label>
          <input type="number" id="maxAttendees" placeholder="Max attendees" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="startAt" class="block text-sm font-medium text-gray-700 mb-1">Event start time</label>
          <input type="datetime-local" id="startAt" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label for="endAt" class="block text-sm font-medium text-gray-700 mb-1">Event end time</label>
          <input type="datetime-local" id="endAt" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <label for="registrationStartAt" class="block text-sm font-medium text-gray-700 mb-1">Registration start</label>
          <input type="datetime-local" id="registrationStartAt" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label for="registrationEndAt" class="block text-sm font-medium text-gray-700 mb-1">Registration end</label>
          <input type="datetime-local" id="registrationEndAt" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
      </div>
      <div>
        <label for="deposit" class="block text-sm font-medium text-gray-700 mb-1">Deposit (VND)</label>
        <input type="number" id="deposit" placeholder="Deposit (VND)" class="w-full px-3 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500" step="0.01" min="0">
      </div>
      <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 font-semibold transition">Create Event</button>
  </form>
    <div id="msg" class="mt-2 text-sm text-red-500"></div>
    <div class="mt-4 text-center">
      <a href="dashboard.html" class="text-blue-600 hover:underline">‚Üê Back to Dashboard</a>
    </div>
  </div>

<script>
document.getElementById("createEventForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const token = localStorage.getItem("token"); // JWT admin
  const title = document.getElementById("title").value;
  const description = document.getElementById("description").value;
  const location = document.getElementById("location").value;
  const minAttendees = parseInt(document.getElementById("minAttendees").value) || null;
  const maxAttendees = parseInt(document.getElementById("maxAttendees").value) || null;
  const deposit = parseFloat(document.getElementById("deposit").value) || 0.0; // M·∫∑c ƒë·ªãnh 0.0 n·∫øu kh√¥ng nh·∫≠p
  const startAt = document.getElementById("startAt").value || null;
  const endAt = document.getElementById("endAt").value || null;
  const registrationStartAt = document.getElementById("registrationStartAt").value || null;
  const registrationEndAt = document.getElementById("registrationEndAt").value || null;

  const msg = document.getElementById("msg");
  msg.textContent = "";
  msg.classList.remove("text-green-500", "text-red-500");

   console.log("üìå Token:", token);
  console.log("üìå Payload g·ª≠i:", {title, description, location, maxAttendees, maxAttendees, startAt, endAt, registrationStartAt, registrationEndAt });
  try {
    const res = await fetch("http://localhost:4000/admin/events/create", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
      },
      body: JSON.stringify({
        title,
        description,
        location,
        minAttendees,
        maxAttendees,
        deposit,
        startAt,
        endAt,
        registrationStartAt,
        registrationEndAt
      })
    });
    console.log("üìå Response status:", res.status);

    const data = await res.json();
    if (!res.ok) throw new Error(data.message || "Failed to create event");

    msg.textContent = "‚úÖ create successful events: " + data.event.title;
    msg.classList.add("text-green-500");

    document.getElementById("createEventForm").reset();
  } catch (err) {
    msg.textContent = "‚ùå " + err.message;
    msg.classList.add("text-red-500");
  }
});
</script>
</body>
</html>
